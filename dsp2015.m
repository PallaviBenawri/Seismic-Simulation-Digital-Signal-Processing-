close all;
m = [7 7 7 7 5];
s = [0 2 0 0 0];
r = [10 10 100 10 10];
h = [10 10 10 2 10];
p = zeros(1,28);
q = zeros(1,28);
w = zeros(1,28);
u = zeros((180/0.02)+1,28);
a1=[-1.017	-0.95	0.89677	-0.83678	-0.60655	-0.65921	-0.65554	-0.76471	-0.87369	-1.527	-1.3186	-1.4281	-1.6501	-1.816	-2.0383	-2.204	-2.3697	-2.5355	-2.7577	-2.9806	-3.4281	-3.72	-4.0423	-4.2082	-4.4302	-4.825	-4.6487	-4.8144];
a2=[0.494	0.51	0.513	0.512	0.507	0.515	0.508	0.523	0.539	0.554	0.577	0.6	0.637	0.668	0.699	0.729	0.752	0.782	0.822	0.866	0.903	0.949	0.987	1.02	1.04	1.065	1.07	1.075];
a3=[-1.7	-1.7	-1.6	-1.6	-1.5	-1.4	-1.4	-1.2	-1.2	-1.1	-1.1	-1	-0.96	-0.94	-0.92	-0.91	-0.9	-0.89	-0.86	-0.83	-0.8	-0.79	-0.77	-0.77	-0.76	-0.78	-0.82	-0.82];
a4=[0.026	0.025	0.024	0.024	0.023	0.02	0.018	0.017	0.015	0.015	0.014	0.013	0.011	0.0085	0.0052	0.0018	-0.0015	-0.0074	-0.011	-0.018	-0.021	-0.024	-0.027	-0.034	-0.043	-0.047	-0.052	-0.053];
a5=[-0.09	-0.09	-0.09	-0.08	-0.09	-0.09	-0.09	-0.075	-0.06	-0.04	-0.04	-0.04	-0.04	-0.055	-0.07	-0.09	-0.1	-0.1	-0.2	-0.2	-0.2	-0.2	-0.2	-0.2	-0.2	-0.2	-0.2	-0.2];
c1=[-0.022	-0.02	-0.029	-0.035	-0.039	-0.036	-0.029	-0.024	-0.017	-0.007	0.0006	0.0024	0.0042	0.0094	0.009	0.0096	0.012	0.017	0.025	0.029	0.035	0.038	0.039	0.043	0.044	0.05	0.059	0.079];
c2=[-0.25	-0.29	-0.39	-0.36	-0.33	-0.12	0.4	0.16	0.3	0.31	0.37	0.33	0.31	0.24	0.02	-0.16	-0.45	-0.65	-0.92	-1.2	-1.4	-1.75	-2.3	-2.8	-3.2	-3.1	-3.1	-3.5];
c3=[1.5	1.9	2.8	3.9	4.5	4.9	4.8	4.9	4.6	4.5	4.5	4.4	4.8	5.3	5.6	6.4	6.8	7.5	8	8.8	9.3	9.6	10	11	11	9.7	7.6	4.4];
b1=[-0.05	-0.037	-0.01	0.018	0.051	0.085	0.096	0.11	0.11	0.1	0.087	0.071	0.059	0.05	0.045	0.047	0.055	0.065	0.077	0.087	0.095	0.098	0.095	0.093	0.084	0.075	0.071	0.072];
b2=[0.67	0.626	0.56	0.491	0.428	0.372	0.341	0.309	0.277	0.253	0.246	0.23	0.22	0.21	0.198	0.198	0.182	0.169	0.15	0.123	0.103	0.075	0.06	0.0475	0.035	0.0475	0.0475	0.037];
b3=[0.006	0.0052	0.0093	0.012	0.0145	0.015	0.0076	-0.0052	-0.017	-0.031	-0.043	-0.05	-0.055	-0.053	-0.056	-0.057	-0.0565	-0.054	-0.051	-0.054	-0.054	-0.0535	-0.0515	-0.043	-0.039	-0.0345	-0.03	-0.025];
b4=[-0.04	-0.11	-0.21	-0.32	-0.48	-0.59	-0.66	-0.68	-0.63	-0.52	-0.38	-0.26	-0.135	-0.027	0.05	0.12	0.12	0.12	0.1	0.13	0.16	0.22	0.29	0.37	0.45	0.54	0.59	0.52];
wavelet = zeros((180/0.02)+1,28);
sigma = power(2,0.25);
omega1 = zeros(1,28);
omega2 = zeros(1,28);
phi2 = zeros(1,28);
phi1 = zeros(1,28);
for i = 1:28
    omega1(i) = (sigma+1)*pi/(2*power(sigma,(i-22)));
    omega2(i) = (sigma-1)*pi/(4*power(sigma,(i-22)));
end
syms t f
psi = (1/(pi*sqrt(sigma-1)))* (sin(sigma*pi*t)-sin(pi*t))/t;
fpsi= fourier(psi,t,f);
fun=power(fpsi,2)/f;
cpsi=int(fun,f,0,inf);
k=(sigma-1/sigma)/(4*pi*cpsi); 
b=-20:0.02:160;
for i=1:1
    for j = -21:6
        p(j+22)= c1(j+22)*r(i)+c2(j+22)*s(i)+c3(j+22);
        q(j+22)= power(10,(b1(j+22)*m(i)+b2(j+22)*log(r(i))/log(10)+b3(j+22)*s(i)+b4(j+22)));
        w(j+22)= power(10,(a1(j+22)+a2(j+22)*m(i)+a3(j+22)*log(r(i))/log(10)+a4(j+22)*h(i)+a5(j+22)*s(i)));
        maxu=-inf;
        maxomega2= -inf;
        maxomega1= -inf;
        for k =1:(180/0.02+1)
            u(k,j+22)= w(j+22)*exp(0.5 + (p(j+22)-b(k))/(2*power(sigma,j)) - exp((p(j+22)-b(k))/q(j+22))*0.5);
            if maxu < u(k,j+22)
                maxu = u(k,j+22);
                posmaxu=k;
            end
            if maxomega2 < sin(omega2(j+22)*b(k))
                maxomega2 = sin(omega2(j+22)*b(k));
                posmaxomega2=k;
            end
            if maxomega1 < sin(omega1(j+22)*b(k))
                maxomega1 = sin(omega2(j+22)*b(k));
                posmaxomega1=k;
            end
        end
        phi2(j+22)=(-posmaxomega2+posmaxu)*omega2(j+22);
        phi1(j+22)=(-posmaxomega1+posmaxu)*omega1(j+22);
        for k =1:(180/0.02+1)
            wavelet(k,j+22) = u(k,j+22)*sqrt((sin(omega2(j+22)*b(k)+phi2(j+22)))^2)*sin(omega1(j+22)*b(k)+phi1(j+22));
        end
    end
    functn=zeros(1,60/0.1+1);        
    for j=-21:6
        a=power(sigma,j);
        for k=1:(180/0.02+1)            
            for mn=1:(60/0.1+1)
                functn(mn)=functn(mn)+wavelet(k,j+22)*(1/(pi*sqrt(sigma-1)))* (sin(sigma*pi*(l(mn)-b(k))/a)-sin(pi*(l(mn)-b(k))/a))/((l(mn)-b(k))*sqrt(a^2));
            end
        end
    end
    l=0:0.1:60;
    plot(l,functn);
%     axis([0,60]);
end